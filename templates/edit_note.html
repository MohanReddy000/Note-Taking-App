{% extends "index.html" %}

{% block content %}
    <div class="container">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            {% for message in form.note_title.errors %}
                <div class="alert alert-danger">{{ message }}</div>
            {% endfor %}

            {% for message in form.note.errors %}
                <div class="alert alert-danger">{{ message }}</div>
            {% endfor %}

            {% for message in form.tags.errors %}
                <div class="alert alert-danger">{{ message }}</div>
            {% endfor %}

            {% for message in get_flashed_messages() %}
            <div class="alert alert-danger">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                {{ message }}
            </div>
            {% endfor %}

            <form method="POST" action="/notes/edit/{{ id }}/">
                <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                    {{ form.csrf_token }}
                    <h3>{{ form.note_id }}</h3>
                    <br>
                    <h3>{{ form.note_title.label }}</h3>
                    <br>
                    {{ form.note_title(class='form-control no_borders') }}
                    <br>
                    {% if form.tags %}
                    <h3>{{ form.tags.label }}</h3>
                    <br>
                    {{ form.tags(class='form-control no_borders') }}</h3>
                    {% endif %}
                </div>
                <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                    <div class="inline-headers">
                        <h3> {{ form.note.label }} </h3>
                        <h5>
                            (Also supports Markdown. For markdown reference visit: <a href="https://en.support.wordpress.com/markdown-quick-reference/">here</a>)
                        </h5>
                    </div>
                    <br>
                    <!-- Add the onchange event here -->
                    {{ form.note(class='form-control no_borders', rows=20, cols="35", onchange="updateNote()") }}
                    <br>
                    <input type="submit" value="Update" class='form-control no_borders btn btn-primary'>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
    <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port );

        socket.on('connect', function() {
        console.log('Connected to Socket.IO');
        });

        socket.on('disconnect', function() {
            console.log('Disconnected from Socket.IO');
        });

        var uniq_id = "{{id}}" ;
        function updateNote() {
           
            var content = document.getElementById("flask-pagedown-note").value;
            socket.emit('update_note', {'id': uniq_id, 'content': content});
        }
        socket.on('note_updated', function(data) {
            if (uniq_id == data.id){
            document.getElementById('flask-pagedown-note').value = data.content;
            }
        });
    </script>
{% endblock %}
